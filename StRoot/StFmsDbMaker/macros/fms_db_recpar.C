#include <iostream.h>
#include <fstream.h>

//read and write Calibration/fms/fmsRec

Int_t fms_db_recpar(char* opt = "readtext run15sim", char* dataspec = "fmsrecpar_lowthre.txt"){
    TString option(opt);
    TString data(dataspec);
    TString storeTime; //that's begin time for validity range for WRITING TO DB 
    int readDate, readTime=0;
    if(option.Contains("run15") && option.Contains("sim")){
	storeTime = "2014-12-10 00:00:02";
	readDate = 20141215;
    }else if(option.Contains("run15") && option.Contains("ofl")){
	storeTime = "2014-12-20 00:00:01";
	readDate = 20141225;
    }	

    std::cout << "Opt =" << opt << "\n";
    std::cout << "readtext  = " << option.Contains("readtext")  << "\n";
    std::cout << "readdb    = " << option.Contains("readdb")    << "\n";
    std::cout << "writedb   = " << option.Contains("writedb")   << "\n";
    std::cout << "writetext = " << option.Contains("writetext") << "\n";
    
    gROOT->Macro("/star/u/yuxip/FMS/myreviewFmsPointMaker/load.C");
    gSystem->Load("St_base.so");
    gSystem->Load("libStDb_Tables.so");
    gSystem->Load("StDbLib.so");
    gSystem->Load("StChain");
    gSystem->Load("StBFChain");
    gSystem->Load("StUtilities");
    gSystem->Load("StIOMaker");
    gSystem->Load("StarClassLibrary");
    gSystem->Load("St_Tables");
    gSystem->Load("StDbLib");
    gSystem->Load("StDbBroker");
    gSystem->Load("St_db_Maker");
    
    //	St_db_Maker* dbMk = new St_db_Maker("db","MySQL:StarDb","$STAR/StarDb");
    //	dbMk->SetDEBUG(0);
    //	dbMk->SetDateTime(readDate, readTime);
    StFmsDbMaker* fmsdb = new StFmsDbMaker("fmsDb");
    fmsdb->setDebug(0);
    StFmsDbConfig& recDbConfig = fmsdb->getRecConfig();
    //max index dimensions
    const Int_t MAX = 80;
    
    //structure to fill up
    fmsRec_st recpar;
    const char* filename = "fmsrecpar.txt";
    //	recDbConfig.fillMap(filename);
    //	recDbConfig.writeMap("tmp1.txt");
    //	std::string a1 = recDbConfig.getParameter("CORNER_LOW_COL");
    //	std::cout << "outside a1 = " << a1 << std::endl;
    
    if(option.Contains("readtext")){
	const char* filename = dataspec;
	std::cout << "filename: " << filename << endl;
	recDbConfig.fillMap(filename);
	//print the internal map. std::cout generated by awk on fmsRec.idl
	std::cout << "ROW_LOW_LIMIT = " << recDbConfig.getParameter("ROW_LOW_LIMIT") << std::endl;
	std::cout << "COL_LOW_LIMIT = " << recDbConfig.getParameter("COL_LOW_LIMIT") << std::endl;
	std::cout << "CEN_ROW_LRG = " << recDbConfig.getParameter("CEN_ROW_LRG") << std::endl;
	std::cout << "CEN_ROW_WIDTH_LRG = " << recDbConfig.getParameter("CEN_ROW_WIDTH_LRG") << std::endl;
	std::cout << "CEN_UPPER_COL_LRG = " << recDbConfig.getParameter("CEN_UPPER_COL_LRG") << std::endl;
	std::cout << "CEN_ROW_SML = " << recDbConfig.getParameter("CEN_ROW_SML") << std::endl;
	std::cout << "CEN_ROW_WIDTH_SML = " << recDbConfig.getParameter("CEN_ROW_WIDTH_SML") << std::endl;
	std::cout << "CEN_UPPER_COL_SML = " << recDbConfig.getParameter("CEN_UPPER_COL_SML") << std::endl;
	std::cout << "CORNER_ROW = " << recDbConfig.getParameter("CORNER_ROW") << std::endl;
	std::cout << "CORNER_LOW_COL = " << recDbConfig.getParameter("CORNER_LOW_COL") << std::endl;
	std::cout << "CLUSTER_BASE = " << recDbConfig.getParameter("CLUSTER_BASE") << std::endl;
	std::cout << "CLUSTER_ID_FACTOR_DET = " << recDbConfig.getParameter("CLUSTER_ID_FACTOR_DET") << std::endl;
	std::cout << "TOTAL_TOWERS = " << recDbConfig.getParameter("TOTAL_TOWERS") << std::endl;
	std::cout << "PEAK_TOWER_FACTOR = " << recDbConfig.getParameter("PEAK_TOWER_FACTOR") << std::endl;
	std::cout << "TOWER_E_THRESHOLD = " << recDbConfig.getParameter("TOWER_E_THRESHOLD") << std::endl;
	std::cout << "BAD_2PH_CHI2 = " << recDbConfig.getParameter("BAD_2PH_CHI2") << std::endl;
	std::cout << "BAD_MIN_E_LRG = " << recDbConfig.getParameter("BAD_MIN_E_LRG") << std::endl;
	std::cout << "BAD_MAX_TOW_LRG = " << recDbConfig.getParameter("BAD_MAX_TOW_LRG") << std::endl;
	std::cout << "BAD_MIN_E_SML = " << recDbConfig.getParameter("BAD_MIN_E_SML") << std::endl;
	std::cout << "BAD_MAX_TOW_SML = " << recDbConfig.getParameter("BAD_MAX_TOW_SML") << std::endl;
	std::cout << "VALID_FT = " << recDbConfig.getParameter("VALID_FT") << std::endl;
	std::cout << "VALID_2ND_FT = " << recDbConfig.getParameter("VALID_2ND_FT") << std::endl;
	std::cout << "VALID_E_OWN = " << recDbConfig.getParameter("VALID_E_OWN") << std::endl;
	std::cout << "SS_C = " << recDbConfig.getParameter("SS_C") << std::endl;
	std::cout << "SS_A1 = " << recDbConfig.getParameter("SS_A1") << std::endl;
	std::cout << "SS_A2 = " << recDbConfig.getParameter("SS_A2") << std::endl;
	std::cout << "SS_A3 = " << recDbConfig.getParameter("SS_A3") << std::endl;
	std::cout << "SS_B1 = " << recDbConfig.getParameter("SS_B1") << std::endl;
	std::cout << "SS_B2 = " << recDbConfig.getParameter("SS_B2") << std::endl;
	std::cout << "SS_B3 = " << recDbConfig.getParameter("SS_B3") << std::endl;
	std::cout << "CAT_NTOWERS_PH1 = " << recDbConfig.getParameter("CAT_NTOWERS_PH1") << std::endl;
	std::cout << "CAT_EP1_PH2 = " << recDbConfig.getParameter("CAT_EP1_PH2") << std::endl;
	std::cout << "CAT_EP0_PH2 = " << recDbConfig.getParameter("CAT_EP0_PH2") << std::endl;
	std::cout << "CAT_SIGMAMAX_MIN_PH2 = " << recDbConfig.getParameter("CAT_SIGMAMAX_MIN_PH2") << std::endl;
	std::cout << "CAT_EP1_PH1 = " << recDbConfig.getParameter("CAT_EP1_PH1") << std::endl;
	std::cout << "CAT_EP0_PH1 = " << recDbConfig.getParameter("CAT_EP0_PH1") << std::endl;
	std::cout << "CAT_SIGMAMAX_MAX_PH1 = " << recDbConfig.getParameter("CAT_SIGMAMAX_MAX_PH1") << std::endl;
	std::cout << "PH1_START_NPH = " << recDbConfig.getParameter("PH1_START_NPH") << std::endl;
	std::cout << "PH1_DELTA_N = " << recDbConfig.getParameter("PH1_DELTA_N") << std::endl;
	std::cout << "PH1_DELTA_X = " << recDbConfig.getParameter("PH1_DELTA_X") << std::endl;
	std::cout << "PH1_DELTA_Y = " << recDbConfig.getParameter("PH1_DELTA_Y") << std::endl;
	std::cout << "PH1_DELTA_E = " << recDbConfig.getParameter("PH1_DELTA_E") << std::endl;
	std::cout << "PH2_START_NPH = " << recDbConfig.getParameter("PH2_START_NPH") << std::endl;
	std::cout << "PH2_START_FSIGMAMAX = " << recDbConfig.getParameter("PH2_START_FSIGMAMAX") << std::endl;
	std::cout << "PH2_RAN_LOW = " << recDbConfig.getParameter("PH2_RAN_LOW") << std::endl;
	std::cout << "PH2_RAN_HIGH = " << recDbConfig.getParameter("PH2_RAN_HIGH") << std::endl;
	std::cout << "PH2_STEP_0 = " << recDbConfig.getParameter("PH2_STEP_0") << std::endl;
	std::cout << "PH2_STEP_1 = " << recDbConfig.getParameter("PH2_STEP_1") << std::endl;
	std::cout << "PH2_STEP_2 = " << recDbConfig.getParameter("PH2_STEP_2") << std::endl;
	std::cout << "PH2_STEP_3 = " << recDbConfig.getParameter("PH2_STEP_3") << std::endl;
	std::cout << "PH2_STEP_4 = " << recDbConfig.getParameter("PH2_STEP_4") << std::endl;
	std::cout << "PH2_STEP_5 = " << recDbConfig.getParameter("PH2_STEP_5") << std::endl;
	std::cout << "PH2_STEP_6 = " << recDbConfig.getParameter("PH2_STEP_6") << std::endl;
	std::cout << "PH2_MAXTHETA_F = " << recDbConfig.getParameter("PH2_MAXTHETA_F") << std::endl;
	std::cout << "PH2_LOWER_NPH = " << recDbConfig.getParameter("PH2_LOWER_NPH") << std::endl;
	std::cout << "PH2_LOWER_XF = " << recDbConfig.getParameter("PH2_LOWER_XF") << std::endl;
	std::cout << "PH2_LOWER_YF = " << recDbConfig.getParameter("PH2_LOWER_YF") << std::endl;
	std::cout << "PH2_LOWER_XMAX_F = " << recDbConfig.getParameter("PH2_LOWER_XMAX_F") << std::endl;
	std::cout << "PH2_LOWER_XMAX_POW = " << recDbConfig.getParameter("PH2_LOWER_XMAX_POW") << std::endl;
	std::cout << "PH2_LOWER_XMAX_LIMIT = " << recDbConfig.getParameter("PH2_LOWER_XMAX_LIMIT") << std::endl;
	std::cout << "PH2_LOWER_5_F = " << recDbConfig.getParameter("PH2_LOWER_5_F") << std::endl;
	std::cout << "PH2_LOWER_6_F = " << recDbConfig.getParameter("PH2_LOWER_6_F") << std::endl;
	std::cout << "PH2_UPPER_NPH = " << recDbConfig.getParameter("PH2_UPPER_NPH") << std::endl;
	std::cout << "PH2_UPPER_XF = " << recDbConfig.getParameter("PH2_UPPER_XF") << std::endl;
	std::cout << "PH2_UPPER_YF = " << recDbConfig.getParameter("PH2_UPPER_YF") << std::endl;
	std::cout << "PH2_UPPER_XMIN_F = " << recDbConfig.getParameter("PH2_UPPER_XMIN_F") << std::endl;
	std::cout << "PH2_UPPER_XMIN_P0 = " << recDbConfig.getParameter("PH2_UPPER_XMIN_P0") << std::endl;
	std::cout << "PH2_UPPER_XMIN_LIMIT = " << recDbConfig.getParameter("PH2_UPPER_XMIN_LIMIT") << std::endl;
	std::cout << "PH2_UPPER_5_F = " << recDbConfig.getParameter("PH2_UPPER_5_F") << std::endl;
	std::cout << "PH2_UPPER_6_F = " << recDbConfig.getParameter("PH2_UPPER_6_F") << std::endl;
	std::cout << "PH2_3_LIMIT_LOWER = " << recDbConfig.getParameter("PH2_3_LIMIT_LOWER") << std::endl;
	std::cout << "PH2_3_LIMIT_UPPER = " << recDbConfig.getParameter("PH2_3_LIMIT_UPPER") << std::endl;
	std::cout << "GL_LOWER_1 = " << recDbConfig.getParameter("GL_LOWER_1") << std::endl;
	std::cout << "GL_UPPER_DELTA_MAXN = " << recDbConfig.getParameter("GL_UPPER_DELTA_MAXN") << std::endl;
	std::cout << "GL_0_DLOWER = " << recDbConfig.getParameter("GL_0_DLOWER") << std::endl;
	std::cout << "GL_0_DUPPER = " << recDbConfig.getParameter("GL_0_DUPPER") << std::endl;
	std::cout << "GL_1_DLOWER = " << recDbConfig.getParameter("GL_1_DLOWER") << std::endl;
	std::cout << "GL_1_DUPPER = " << recDbConfig.getParameter("GL_1_DUPPER") << std::endl;
	std::cout << "GL_2_DLOWER = " << recDbConfig.getParameter("GL_2_DLOWER") << std::endl;
	std::cout << "GL_2_DUPPER = " << recDbConfig.getParameter("GL_2_DUPPER") << std::endl;
    }	
    
    if(option.Contains("readdb")){
	
	gSystem->Load("StChain");
	gSystem->Load("StBFChain");
	gSystem->Load("StUtilities");
	gSystem->Load("StIOMaker");
	gSystem->Load("StarClassLibrary");
	gSystem->Load("St_Tables");
	gSystem->Load("StDbLib");
	gSystem->Load("StDbBroker");
	gSystem->Load("St_db_Maker");
	
	St_db_Maker *dbMk=new St_db_Maker("db", "MySQL:StarDb", "$STAR/StarDb");
	dbMk->SetDebug();
	dbMk->SetDateTime(readDate,readTime);
	dbMk->SetFlavor("ofl");		
	dbMk->Init();
	dbMk->Make();
	
	TDataSet *DB = 0;
	DB = dbMk->GetInputDB("Calibrations/fms");
	if (!DB) { std::cout << "ERROR: no db maker?" << std::endl; }
	
	St_fmsRec *dbrecpar = 0;
	dbrecpar = (St_fmsRec*) DB->Find("fmsRec");
	int ifield = 0;
	if(dbrecpar){
	    std::cout << "Reading fmsRec table" << endl;
	    fmsRec_st *rectable = dbrecpar->GetTable();
	    recDbConfig.readMap(*rectable);
	    
	    //print the internal map
	    std::cout << "ROW_LOW_LIMIT = " << recDbConfig.getParameter("ROW_LOW_LIMIT") << std::endl;
	    std::cout << "COL_LOW_LIMIT = " << recDbConfig.getParameter("COL_LOW_LIMIT") << std::endl;
	    std::cout << "CEN_ROW_LRG = " << recDbConfig.getParameter("CEN_ROW_LRG") << std::endl;
	    std::cout << "CEN_ROW_WIDTH_LRG = " << recDbConfig.getParameter("CEN_ROW_WIDTH_LRG") << std::endl;
	    std::cout << "CEN_UPPER_COL_LRG = " << recDbConfig.getParameter("CEN_UPPER_COL_LRG") << std::endl;
	    std::cout << "CEN_ROW_SML = " << recDbConfig.getParameter("CEN_ROW_SML") << std::endl;
	    std::cout << "CEN_ROW_WIDTH_SML = " << recDbConfig.getParameter("CEN_ROW_WIDTH_SML") << std::endl;
	    std::cout << "CEN_UPPER_COL_SML = " << recDbConfig.getParameter("CEN_UPPER_COL_SML") << std::endl;
	    std::cout << "CORNER_ROW = " << recDbConfig.getParameter("CORNER_ROW") << std::endl;
	    std::cout << "CORNER_LOW_COL = " << recDbConfig.getParameter("CORNER_LOW_COL") << std::endl;
	    std::cout << "CLUSTER_BASE = " << recDbConfig.getParameter("CLUSTER_BASE") << std::endl;
	    std::cout << "CLUSTER_ID_FACTOR_DET = " << recDbConfig.getParameter("CLUSTER_ID_FACTOR_DET") << std::endl;
	    std::cout << "TOTAL_TOWERS = " << recDbConfig.getParameter("TOTAL_TOWERS") << std::endl;
	    std::cout << "PEAK_TOWER_FACTOR = " << recDbConfig.getParameter("PEAK_TOWER_FACTOR") << std::endl;
	    std::cout << "TOWER_E_THRESHOLD = " << recDbConfig.getParameter("TOWER_E_THRESHOLD") << std::endl;
	    std::cout << "BAD_2PH_CHI2 = " << recDbConfig.getParameter("BAD_2PH_CHI2") << std::endl;
	    std::cout << "BAD_MIN_E_LRG = " << recDbConfig.getParameter("BAD_MIN_E_LRG") << std::endl;
	    std::cout << "BAD_MAX_TOW_LRG = " << recDbConfig.getParameter("BAD_MAX_TOW_LRG") << std::endl;
	    std::cout << "BAD_MIN_E_SML = " << recDbConfig.getParameter("BAD_MIN_E_SML") << std::endl;
	    std::cout << "BAD_MAX_TOW_SML = " << recDbConfig.getParameter("BAD_MAX_TOW_SML") << std::endl;
	    std::cout << "VALID_FT = " << recDbConfig.getParameter("VALID_FT") << std::endl;
	    std::cout << "VALID_2ND_FT = " << recDbConfig.getParameter("VALID_2ND_FT") << std::endl;
	    std::cout << "VALID_E_OWN = " << recDbConfig.getParameter("VALID_E_OWN") << std::endl;
	    std::cout << "SS_C = " << recDbConfig.getParameter("SS_C") << std::endl;
	    std::cout << "SS_A1 = " << recDbConfig.getParameter("SS_A1") << std::endl;
	    std::cout << "SS_A2 = " << recDbConfig.getParameter("SS_A2") << std::endl;
	    std::cout << "SS_A3 = " << recDbConfig.getParameter("SS_A3") << std::endl;
	    std::cout << "SS_B1 = " << recDbConfig.getParameter("SS_B1") << std::endl;
	    std::cout << "SS_B2 = " << recDbConfig.getParameter("SS_B2") << std::endl;
	    std::cout << "SS_B3 = " << recDbConfig.getParameter("SS_B3") << std::endl;
	    std::cout << "CAT_NTOWERS_PH1 = " << recDbConfig.getParameter("CAT_NTOWERS_PH1") << std::endl;
	    std::cout << "CAT_EP1_PH2 = " << recDbConfig.getParameter("CAT_EP1_PH2") << std::endl;
	    std::cout << "CAT_EP0_PH2 = " << recDbConfig.getParameter("CAT_EP0_PH2") << std::endl;
	    std::cout << "CAT_SIGMAMAX_MIN_PH2 = " << recDbConfig.getParameter("CAT_SIGMAMAX_MIN_PH2") << std::endl;
	    std::cout << "CAT_EP1_PH1 = " << recDbConfig.getParameter("CAT_EP1_PH1") << std::endl;
	    std::cout << "CAT_EP0_PH1 = " << recDbConfig.getParameter("CAT_EP0_PH1") << std::endl;
	    std::cout << "CAT_SIGMAMAX_MAX_PH1 = " << recDbConfig.getParameter("CAT_SIGMAMAX_MAX_PH1") << std::endl;
	    std::cout << "PH1_START_NPH = " << recDbConfig.getParameter("PH1_START_NPH") << std::endl;
	    std::cout << "PH1_DELTA_N = " << recDbConfig.getParameter("PH1_DELTA_N") << std::endl;
	    std::cout << "PH1_DELTA_X = " << recDbConfig.getParameter("PH1_DELTA_X") << std::endl;
	    std::cout << "PH1_DELTA_Y = " << recDbConfig.getParameter("PH1_DELTA_Y") << std::endl;
	    std::cout << "PH1_DELTA_E = " << recDbConfig.getParameter("PH1_DELTA_E") << std::endl;
	    std::cout << "PH2_START_NPH = " << recDbConfig.getParameter("PH2_START_NPH") << std::endl;
	    std::cout << "PH2_START_FSIGMAMAX = " << recDbConfig.getParameter("PH2_START_FSIGMAMAX") << std::endl;
	    std::cout << "PH2_RAN_LOW = " << recDbConfig.getParameter("PH2_RAN_LOW") << std::endl;
	    std::cout << "PH2_RAN_HIGH = " << recDbConfig.getParameter("PH2_RAN_HIGH") << std::endl;
	    std::cout << "PH2_STEP_0 = " << recDbConfig.getParameter("PH2_STEP_0") << std::endl;
	    std::cout << "PH2_STEP_1 = " << recDbConfig.getParameter("PH2_STEP_1") << std::endl;
	    std::cout << "PH2_STEP_2 = " << recDbConfig.getParameter("PH2_STEP_2") << std::endl;
	    std::cout << "PH2_STEP_3 = " << recDbConfig.getParameter("PH2_STEP_3") << std::endl;
	    std::cout << "PH2_STEP_4 = " << recDbConfig.getParameter("PH2_STEP_4") << std::endl;
	    std::cout << "PH2_STEP_5 = " << recDbConfig.getParameter("PH2_STEP_5") << std::endl;
	    std::cout << "PH2_STEP_6 = " << recDbConfig.getParameter("PH2_STEP_6") << std::endl;
	    std::cout << "PH2_MAXTHETA_F = " << recDbConfig.getParameter("PH2_MAXTHETA_F") << std::endl;
	    std::cout << "PH2_LOWER_NPH = " << recDbConfig.getParameter("PH2_LOWER_NPH") << std::endl;
	    std::cout << "PH2_LOWER_XF = " << recDbConfig.getParameter("PH2_LOWER_XF") << std::endl;
	    std::cout << "PH2_LOWER_YF = " << recDbConfig.getParameter("PH2_LOWER_YF") << std::endl;
	    std::cout << "PH2_LOWER_XMAX_F = " << recDbConfig.getParameter("PH2_LOWER_XMAX_F") << std::endl;
	    std::cout << "PH2_LOWER_XMAX_POW = " << recDbConfig.getParameter("PH2_LOWER_XMAX_POW") << std::endl;
	    std::cout << "PH2_LOWER_XMAX_LIMIT = " << recDbConfig.getParameter("PH2_LOWER_XMAX_LIMIT") << std::endl;
	    std::cout << "PH2_LOWER_5_F = " << recDbConfig.getParameter("PH2_LOWER_5_F") << std::endl;
	    std::cout << "PH2_LOWER_6_F = " << recDbConfig.getParameter("PH2_LOWER_6_F") << std::endl;
	    std::cout << "PH2_UPPER_NPH = " << recDbConfig.getParameter("PH2_UPPER_NPH") << std::endl;
	    std::cout << "PH2_UPPER_XF = " << recDbConfig.getParameter("PH2_UPPER_XF") << std::endl;
	    std::cout << "PH2_UPPER_YF = " << recDbConfig.getParameter("PH2_UPPER_YF") << std::endl;
	    std::cout << "PH2_UPPER_XMIN_F = " << recDbConfig.getParameter("PH2_UPPER_XMIN_F") << std::endl;
	    std::cout << "PH2_UPPER_XMIN_P0 = " << recDbConfig.getParameter("PH2_UPPER_XMIN_P0") << std::endl;
	    std::cout << "PH2_UPPER_XMIN_LIMIT = " << recDbConfig.getParameter("PH2_UPPER_XMIN_LIMIT") << std::endl;
	    std::cout << "PH2_UPPER_5_F = " << recDbConfig.getParameter("PH2_UPPER_5_F") << std::endl;
	    std::cout << "PH2_UPPER_6_F = " << recDbConfig.getParameter("PH2_UPPER_6_F") << std::endl;
	    std::cout << "PH2_3_LIMIT_LOWER = " << recDbConfig.getParameter("PH2_3_LIMIT_LOWER") << std::endl;
	    std::cout << "PH2_3_LIMIT_UPPER = " << recDbConfig.getParameter("PH2_3_LIMIT_UPPER") << std::endl;
	    std::cout << "GL_LOWER_1 = " << recDbConfig.getParameter("GL_LOWER_1") << std::endl;
	    std::cout << "GL_UPPER_DELTA_MAXN = " << recDbConfig.getParameter("GL_UPPER_DELTA_MAXN") << std::endl;
	    std::cout << "GL_0_DLOWER = " << recDbConfig.getParameter("GL_0_DLOWER") << std::endl;
	    std::cout << "GL_0_DUPPER = " << recDbConfig.getParameter("GL_0_DUPPER") << std::endl;
	    std::cout << "GL_1_DLOWER = " << recDbConfig.getParameter("GL_1_DLOWER") << std::endl;
	    std::cout << "GL_1_DUPPER = " << recDbConfig.getParameter("GL_1_DUPPER") << std::endl;
	    std::cout << "GL_2_DLOWER = " << recDbConfig.getParameter("GL_2_DLOWER") << std::endl;
	    std::cout << "GL_2_DUPPER = " << recDbConfig.getParameter("GL_2_DUPPER") << std::endl;
	}
	
	else {
	    std::cout << "WARNING: No data in fmsRec table (wrong timestamp?). Nothing to return" << endl;
	}
    }
    
    if(option.Contains("writetext")){
	const char* filename = data.Data();
	recDbConfig.writeMap(filename);
    }
    
    if(option.Contains("writedb")){	
	if(recDbConfig.isMapEmpty()){
	    std::cout << "internal map empty, please load map first" << std::endl;
	    return 0;
	}				
	gSystem->Setenv("DB_ACCESS_MODE","write");
	StDbManager* mgr = StDbManager::Instance();
	StDbConfigNode* node = mgr->initConfig("Calibrations_fms");
	StDbTable* table = node->addDbTable("fmsRec");
	mgr->setStoreTime(storeTime.Data());
	
	recDbConfig.fillFmsRec(recpar);
	table->SetTable((char*)&recpar,1);
	
	mgr->storeDbTable(table);
	
	gSystem->Unsetenv("DB_ACCESS_MODE");
	std::cout << "Done with database upload" << endl;
    }
    
    return 1;
}





