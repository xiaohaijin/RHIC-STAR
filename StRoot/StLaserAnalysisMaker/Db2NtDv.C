class St_db_Maker;
St_db_Maker *dbMk = 0;
struct DateTime_t {Int_t date, time,  run; Double_t DriftVel;};
DateTime_t dates[] = {
#if 1
{20050112,  50534, 6012001,   5.51158},
{20050112,  50758, 6012002,   5.51569},
{20050112,  95303, 6012016,   5.5132},
{20050112, 133813, 6012033,   5.51618},
{20050112, 135406, 6012035,   5.51455},
{20050113, 101622, 6013045,   5.52229},
{20050113, 141843, 6013065,   5.52361},
{20050115,  41638, 6014101,   5.53022},
{20050115, 141755, 6015033,   5.53198},
{20050116,   1145, 6015048,   5.53351},
{20050116, 152429, 6016016,   5.5368},
{20050116, 214621, 6016052,   5.53951},
{20050117,  65455, 6017010,   5.54057},
{20050117, 175657, 6017059,   5.54217},
{20050118, 100541, 6018008,   5.54382},
{20050118, 124710, 6018013,   5.54412},
{20050119,   2831, 6018043,   5.54583},
{20050120, 203341, 6020026,   5.55259},
{20050121,  34208, 6020063,   5.55251},
{20050121,  95757, 6021008,   5.55296},
{20050122,  12419, 6021046,   5.5529},
{20050122,  91552, 6022008,   5.55378},
{20050122, 181854, 6022047,   5.55532},
{20050123,  12353, 6022091,  5.55527},
{20050123,  75912, 6023010,   5.55453},
{20050125,  90829, 6025039,   5.55641},
{20050125, 123652, 6025051,   5.5545},
{20050126,  64957, 6026019,   5.55327},
{20050126, 132839, 6026047,   5.55412},
{20050126, 160050, 6026062,   5.55436},
{20050126, 160545, 6026063,   5.55412},
{20050126, 161052, 6026064,   5.55373},
{20050126, 161611, 6026065,   5.55393},
{20050126, 211937, 6026080,   5.55416},
{20050127,  25328, 6026099,   5.55333},
{20050127, 105558, 6027019,   5.55268},
{20050128,  11529, 6027068,   5.55317},
{20050128, 103114, 6028005,   5.55379},
{20050129,  12044, 6028079,   5.55317},
{20050129,  65330, 6029006,   5.55541},
{20050129, 123942, 6029020,   5.55685},
{20050130, 191841, 6030063,   5.55509},
{20050204, 234609, 6035110,   5.53933},
{20050205,  65947, 6036015,   5.53788},
{20050206,  14944, 6036099,   5.53647},
{20050206,  80215, 6037012,   5.53488},
{20050206, 202739, 6037051,   5.53423},
{20050207,  33312, 6037072,   5.53359},
{20050207,  82020, 6038010,   5.53304},
{20050208,   5610, 6039030,   5.53217},
{20050208, 231639, 6039137,   5.53247},
{20050209,  62924, 6040002,   5.53152},
{20050210,   3726, 6040046,   5.53055},
{20050210,   5835, 6040047,   5.53017},
{20050210,  73740, 6041019,   5.52913},
{20050210, 135549, 6041052,   5.52792},
{20050210, 235401, 6041094,   5.52832},
{20050211,  51902, 6042002,   5.52798},
{20050212, 212458, 6043088,   5.52926},
{20050213,  94115, 6044023,   5.52825},
{20050213, 185950, 6044052,   5.52902},
{20050214,  80622, 6045032,   5.52836},
{20050215,  81343, 6046021,   5.52719},
{20050215, 121651, 6046036,   5.52685},
{20050216,  85004, 6047024,   5.52791},
{20050216, 120550, 6047041,   5.52746},
{20050217, 105839, 6048015,   5.52682},
{20050218,  32216, 6048078,   5.52986},
{20050218, 100313, 6049035,   5.52971},
{20050219,  74124, 6050014,   5.53347},
{20050220,  44905, 6050133,   5.5351},
{20050220, 102253, 6051019,   5.53449},
{20050220, 144158, 6051039,   5.53475},
{20050221,  53352, 6052002,   5.53392},
{20050221, 162646, 6052060,   5.53456},
{20050222, 114907, 6053023,   5.53526},
{20050223,  61531, 6054012,   5.53338},
{20050223, 110532, 6054033,   5.53299},
{20050224,  21836, 6054065,   5.532},
{20050224,  84010, 6055010,   5.53268},
{20050224, 163733, 6055029,   5.53269},
{20050225,  23504, 6055087,   5.53288},
{20050226,  30130, 6056064,   5.53429},
{20050226, 120455, 6057044,   5.53361},
{20050226, 213328, 6057061,   5.53604},
{20050227,  31649, 6057089,   5.53715},
{20050227, 151947, 6058034,   5.53684},
{20050227, 213739, 6058060,   5.5374},
{20050228,  31937, 6058083,   5.53682},
{20050228, 101606, 6059017,   5.53681},
{20050301,  23343, 6059060,   5.53771},
{20050301, 102410, 6060015,   5.53725},
{20050301, 103609, 6060017,   5.53668},
{20050301, 151134, 6060032,   5.53748},
{20050305,  15503, 6063050,   5.53586},
{20050305, 120235, 6064038,   5.53513},
{20050305, 151405, 6064055,   5.53589},
//{20050306, 144259, 6065019,   5.53557},
{20050306, 144726, 6065020,   5.53568},
{20050306, 211045, 6065040,   5.54223},
{20050307,   3049, 6065057,   5.53381},
{20050310,  83948, 6069011,   5.53228},
{20050311,   4050, 6069096,   5.53175},
{20050311,  83919, 6070008,   5.53267},
{20050312,   5732, 6070082,   5.53184},
{20050312,  73517, 6071009,   5.5311},
{20050313,  30411, 6071090,   5.53233},
{20050313, 101722, 6072016,   5.53222},
{20050314,  93720, 6073011,   5.53181},
{20050315,  52118, 6074001,   5.53001},
{20050315, 131634, 6074022,   5.53014},
{20050316,  65929, 6075017,   5.53025},
{20050316, 124811, 6075039,   5.52925},
{20050317,  10452, 6075129,   5.52944},
{20050317,  93921, 6076026,   5.52962},
{20050317,  94346, 6076028,   5.52994},
{20050318,    711, 6076096,   5.53064},
{20050318,  50016, 6076120,   5.53024},
{20050318, 110515, 6077035,   5.5301},
{20050319,  62423, 6078010,   5.5303},
{20050319, 122635, 6078040,   5.53046},
{20050319, 185246, 6078069,   5.52945},
{20050319, 220211, 6078081,   5.52949},
{20050320,  62136, 6079006,   5.52902},
{20050320, 142834, 6079050,   5.52904},
{20050321,  63242, 6080008,   5.52811},
{20050321, 102111, 6080022,   5.52798},
{20050322,  75613, 6081015,   5.52662},
{20050323,  73716, 6082013,   5.5255},
{20050324,  90321, 6083016,   5.52539}
#else
  //  {20050112,  50534, 6012001,  5.41649}, // too low 
{20050112,  50758, 6012002,  5.51157},
{20050112,  95303, 6012016,  5.5132},
//  {20050112, 132842, 6012030,  5.61488}, // too high, correction -1.6%
{20050113, 101622, 6013045,  5.5223},
{20050113, 141843, 6013065,  5.52435},
{20050115,  41638, 6014101,  5.54366},
{20050115, 141755, 6015033,  5.53199},
{20050116,   1145, 6015048,  5.53364},
{20050116,  25914, 6015060,  5.534},
{20050116, 152429, 6016016,  5.53679},
{20050116, 214621, 6016052,  5.53725},
{20050117,  65455, 6017010,  5.54066},
{20050117, 175657, 6017059,  5.54225},
{20050118, 100541, 6018008,  5.54283},
{20050120, 203341, 6020026,  5.55234},
{20050121,  34208, 6020063,  5.54418},
{20050121,  95757, 6021008,  5.54934},
{20050122,  12419, 6021046,  5.55269},
{20050122,  91552, 6022008,  5.55323},
{20050122, 181854, 6022047,  5.54593},
{20050123,  12353, 6022091,  5.55532},
{20050123,  75912, 6023010,  5.54408},
{20050125,  90829, 6025039,  5.54859},
{20050125, 123652, 6025051,  5.55462},
{20050126,   3421, 6025113,  5.55414},
{20050126,   4111, 6025114,  5.55299},
{20050126,  64957, 6026019,  5.5437},
{20050126, 132839, 6026047,  5.54863},
  //  {20050126, 160050, 6026062,  5.65475}, // too high, correction -1.6%
{20050126, 211641, 6026079,  5.5407},
{20050127,  25328, 6026099,  5.54604},
{20050127, 105558, 6027019,  5.54545},
{20050128,  11529, 6027068,  5.53774},
{20050128, 103114, 6028005,  5.54783},
{20050129,  12044, 6028079,  5.53631},
{20050129,  65330, 6029006,  5.5554},
{20050129, 123942, 6029020,  5.55688},
{20050130,  40833, 6029065,  5.55695},
{20050130,  81847, 6030014,  5.56481},
{20050130, 191841, 6030063,  5.56136},
{20050131,  11315, 6030095,  5.54455},
{20050131,  81832, 6031007,  5.55291},
{20050131, 142745, 6031035,  5.54009},
{20050201,  40502, 6031112,  5.55085},
{20050201,  91018, 6032012,  5.53852},
{20050201, 194502, 6032033,  5.50951},
{20050203, 113858, 6034011,  5.53663},
{20050203, 141730, 6034018,  5.53663},
{20050204,   5142, 6034110,  5.53823},
{20050204,  61742, 6035008,  5.51409},
{20050204, 123111, 6035029,  5.51517},
{20050204, 234609, 6035110,  5.53393},
{20050205,  65947, 6036015,  5.53794},
{20050205, 140613, 6036041,  5.53763},
{20050206,  14944, 6036099,  5.53648},
{20050206,  80215, 6037012,  5.52662},
{20050206, 141515, 6037032,  5.51939},
{20050206, 202739, 6037051,  5.53042},
{20050207,  33312, 6037072,  5.52101},
{20050207,  82020, 6038010,  5.53307},
{20050208,  41502, 6038086,  5.53247},
{20050208, 105610, 6039030,  5.53212},
{20050208, 135930, 6039047,  5.52078},
{20050208, 231639, 6039137,  5.53248},
{20050209,  62924, 6040002,  5.52961},
{20050210,   3726, 6040046,  5.52311},
{20050210,  73740, 6041019,  5.52911},
{20050210, 135549, 6041052,  5.52823},
{20050210, 235401, 6041094,  5.52823},
{20050211,  51902, 6042002,  5.52801},
{20050211, 123421, 6042056,  5.5291},
{20050212,  11513, 6042106,  5.52945},
//{20050212,  70259, 6043013,  5.5291}, no problem 
{20050212, 141340, 6043053,  5.52952},
{20050212, 212458, 6043088,  5.52887},
{20050213,  24905, 6043116,  5.52894},
{20050213,  94115, 6044023,  5.52421},
{20050213, 185950, 6044052,  5.52766},
{20050214,  10251, 6044082,  5.52581},
{20050214,  80622, 6045032,  5.52645},
{20050215,  24515, 6045074,  5.523},
{20050215,  81343, 6046021,  5.52722},
{20050215, 121651, 6046036,  5.527},
{20050216,  85004, 6047024,  5.52791},
{20050216, 120550, 6047041,  5.5275},
{20050217, 105839, 6048015,  5.52684},
{20050218,  32216, 6048078,  5.52786},
{20050218, 100313, 6049035,  5.52804},
{20050218, 192936, 6049093,  5.52867},
{20050219,  30018, 6049121,  5.52961},
{20050219,  74124, 6050014,  5.52577},
{20050219, 140650, 6050038,  5.52763},
{20050220,   1609, 6050118,  5.52805},
{20050220,  44905, 6050133,  5.52617},
{20050220, 102253, 6051019,  5.53095},
{20050220, 144158, 6051039,  5.53022},
{20050220, 190400, 6051051,  5.52564},
{20050221,  53352, 6052002,  5.53205},
{20050221, 102253, 6052029,  5.53284},
{20050221, 162646, 6052060,  5.53282},
{20050221, 225714, 6052097,  5.53292},
{20050222, 114907, 6053023,  5.53075},
{20050222, 234210, 6053086,  5.52792},
{20050223,  61531, 6054012,  5.52486},
{20050223, 110532, 6054033,  5.53075},
{20050224,  21836, 6054065,  5.53024},
{20050224,  84010, 6055010,  5.52837},
{20050224, 163733, 6055029,  5.53052},
{20050225,  23504, 6055087,  5.52509},
{20050226,  30130, 6056064,  5.52827},
{20050226, 120455, 6057044,  5.52825},
{20050226, 213328, 6057061,  5.53108},
{20050227,  31649, 6057089,  5.52834},
{20050227,  81653, 6058012,  5.52791},
{20050227, 151947, 6058034,  5.5345},
{20050227, 213739, 6058060,  5.53537},
{20050228,  31937, 6058083,  5.53494},
{20050228, 101606, 6059017,  5.52675},
{20050301,  23343, 6059060,  5.53197},
{20050301, 102410, 6060015,  5.52895},
{20050301, 151134, 6060032,  5.53204},
{20050301, 205041, 6060061,  5.53292},
{20050302,  91930, 6061032,  5.5338},
{20050305,  15503, 6063050,  5.5293},
{20050305, 120235, 6064038,  5.52966},
{20050305, 151405, 6064055,  5.53044},
{20050306,  33120, 6064101,  5.52509},
//{20050306, 144259, 6065019,  5.5339}, no problem
{20050306, 211045, 6065040,  5.54036},
{20050307,   3049, 6065057,  5.52115},
{20050310,  83948, 6069011,  5.52924},
{20050310, 142906, 6069050,  5.53049},
{20050311,   4050, 6069096,  5.53251},
{20050311, 145622, 6070055,  5.53367},
{20050312,   5732, 6070082,  5.53116},
{20050312,  73517, 6071009,  5.53184},
{20050312, 144500, 6071041,  5.53136},
{20050312, 211742, 6071070,  5.53131},
{20050313,  30411, 6071090,  5.5322},
{20050313, 101722, 6072016,  5.5331},
{20050313, 172954, 6072036,  5.53156},
{20050314,  93720, 6073011,  5.53003},
{20050314, 152923, 6073040,  5.52837},
{20050314, 210618, 6073068,  5.5319},
{20050315,  52118, 6074001,  5.52993},
{20050315, 131634, 6074022,  5.53115},
{20050315, 221841, 6074085,  5.54607},
{20050316,  65929, 6075017,  5.52875},
{20050316, 124811, 6075039,  5.52795},
{20050317,  10452, 6075129,  5.52722},
{20050317,  42414, 6075150,  5.52759},
{20050317,  93921, 6076026,  5.52837},
{20050317,  94346, 6076028,  5.529},
{20050318,    711, 6076096,  5.53087},
{20050318,  50016, 6076120,  5.5291},
{20050318, 110515, 6077035,  5.5295},
{20050318, 192434, 6077066,  5.5288},
{20050319,  62423, 6078010,  5.5293},
{20050319, 122635, 6078040,  5.52927},
{20050319, 185246, 6078069,  5.54693},
{20050319, 220211, 6078081,  5.53029},
{20050320,  62136, 6079006,  5.52818},
{20050320,  81738, 6079018,  5.53008},
{20050320, 142834, 6079050,  5.52964},
{20050320, 203752, 6079099,  5.52911},
{20050321,  13809, 6079122,  5.52673},
{20050321,  63242, 6080008,  5.52614},
{20050321, 102111, 6080022,  5.52656},
{20050322,  75613, 6081015,  5.52739},
{20050323,  73716, 6082013,  5.52478},
{20050324,  90321, 6083016,  5.52537}
#endif
};  
const Int_t NDates = sizeof(dates)/sizeof(DateTime_t);
struct Row_t {
  Float_t day;
  Float_t date, time, ut,  run,  dvel, Dbdvel; 
  Float_t barometricPressure;        // mbar : TPC-PTB
  Float_t inputTPCGasPressure;       // mbar : TPC-PT8
  Float_t nitrogenPressure;          // mbar : TPC-PI15
  Float_t gasPressureDiff;           // mbar : TPC-PT7
  Float_t inputGasTemperature;       // degrees C
  Float_t outputGasTemperature;      // degrees C
  Float_t flowRateArgon1;            // liters/min : TPC-FM4
  Float_t flowRateArgon2;            // liters/min : TPC-FM4
  Float_t flowRateMethane;           // liters/min : TPC-FM1
  Float_t percentMethaneIn;          // percent : TPC-CH4M3
  Float_t ppmOxygenIn;               // ppm : TPC-O2M1
  Float_t flowRateExhaust;           // liters/min : TPC-PT11
  Float_t percentMethaneOut;         // ppm : TPC-M4
  Float_t ppmWaterOut;               // ppm : TPC-M2
  Float_t ppmOxygenOut;              // scf/hr : TPC-O2M1
  Float_t flowRateRecirculation;     // liters/min : TPC-F17

  Float_t barometricPressureAv;        // mbar : TPC-PTB
  Float_t inputGasTemperatureAv;       // degrees C
  Float_t outputGasTemperatureAv;      // degrees C
  Float_t percentMethaneInAv;          // percent : TPC-CH4M3
  Float_t percentMethaneOutAv;         // ppm : TPC-M4
};
const Char_t *vars = "day:date:time:ut:run:dvel:Dbdvel:barometricPressure:inputTPCGasPressure:nitrogenPressure:gasPressureDiff:inputGasTemperature:outputGasTemperature:flowRateArgon1:flowRateArgon2:flowRateMethane:percentMethaneIn:ppmOxygenIn:flowRateExhaust:percentMethaneOut:ppmWaterOut:ppmOxygenOut:flowRateRecirculation:barometricPressureAv:inputGasTemperatureAv:outputGasTemperatureAv:percentMethaneInAv:percentMethaneOutAv";
//________________________________________________________________________________
void Load() {
  if (gClassTable->GetID("StDbManager") < 0) {
    // Baseline shared libraries
    //    gSystem->Load("libTable");
    gSystem->Load("/usr/lib/libmysqlclient");
    gSystem->Load("St_base"); 
    gSystem->Load("StChain");
    gSystem->Load("StUtilities");
    // DB-specific libs
    // may only need libStDb_Tables.so
    // but may need St_Tables.so... so I'm using this one
    //  gSystem->Load("libStDb_Tables.so");
    gSystem->Load("libStDb_Tables.so");
    gSystem->Load("StDbLib.so");
    gSystem->Load("StDbBroker.so"); 
    gSystem->Load("St_db_Maker.so");
  }
  dbMk = new St_db_Maker("db","MySQL:StarDb","$STAR/StarDb","$PWD/StarDb");
  dbMk->SetDebug(1);
  // dbMk->SetFlavor("NewlaserDV","tpcDriftVelocity");
  dbMk->SetFlavor("laserDV","tpcDriftVelocity");
  //  dbMk->SetFlavor("ofl+sim");
//   dbMk->SetFlavor("simu","svtWafersPosition"); 
//   dbMk->SetFlavor("sim","tpcGlobalPosition");
//   dbMk->SetFlavor("sim","tpcSectorPosition");
//   dbMk->SetFlavor("sim","tpcISTimeOffsets");
//   dbMk->SetFlavor("sim","tpcOSTimeOffsets");
  dbMk->Init();
}
//________________________________________________________________________________
//void Db(const Char_t *tabNam  = "Calibrations/tpc/noiseElim", 
void Db2NtDv(Int_t i0=0){ 
  if (dbMk == 0) Load();
  //  dbMk->SetDebug(4);
  //  dbMk->SetFlavor("ofl+laserDV","tpcDriftVelocity");
  //  dbMk->SetMaxEntryTime(20060620,0);
  // to browse 1 database, use this one
  Int_t i = 0;
  Row_t row;
  TNtuple *FitP = new TNtuple("FitP","Drift velocity",vars);
  TDatime t0(2005,1,1,0,0,0);
  Int_t ut0 = t0.Convert();
  TDatime t[2];
  TDataSet *set = 0;
  for (i = i0; i < NDates; i++) {
    memset(&row.day, 0, sizeof(Row_t));
    TDatime tt(dates[i].date,dates[i].time);
    Int_t ut = tt.Convert();
    row.day = (ut - ut0)/(24.*3600.) + 1;
    row.ut = ut;
    row.date = dates[i].date;
    row.time = dates[i].time;
    row.run = dates[i].run;
    row.dvel = dates[i].DriftVel;
    Int_t date = dates[i].date;
    Int_t time = dates[i].time;
    for (Int_t k = 0; k < 10; k++) {
      if (k > 0 && date == dates[i].date && time == dates[i].time) break;
      dbMk->SetDateTime(date,time+1); 
      dbMk->Clear();
      dbMk->Make();
      set = dbMk->GetDataBase("Calibrations/tpc");
      if (! set) {
	cout << "==================================== Calibrations/tpc has not been found i =" << i << endl;
	continue;
      }
      if (k == 0) {
	St_tpcDriftVelocity *tpcDriftVelocity = (St_tpcDriftVelocity *) set->Find("tpcDriftVelocity");
	if (tpcDriftVelocity) {
	  dbMk->GetValidity(tpcDriftVelocity,t);
	  cout << "got " << tpcDriftVelocity->GetName() << " for d/t " << dates[i].date << "/" << dates[i].time << endl;
	  cout << "Found tpcDriftVelocity " << tpcDriftVelocity->GetName()  << endl;
	  cout << "Validity:" << t[0].GetDate() << "/" << t[0].GetTime()
	       << " -----   " << t[1].GetDate() << "/" << t[1].GetTime() << endl;
	  //	  tpcDriftVelocity->Print(0,1);
	  tpcDriftVelocity_st *drift = tpcDriftVelocity->GetTable();
	  row.Dbdvel = drift->laserDriftVelocityEast;
	  cout << "got " << tpcDriftVelocity->GetName() << " for d/t " << dates[i].date << "/"  << dates[i].time 
	       << " dv = " << row.Dbdvel  << endl;
	} else {
	  row.Dbdvel = -1;
	  //	  set->ls(9);
	  cout << "==================================== tpcDriftVelocity has not been found i = " << i << "\t" << dates[i].date << "\t" << dates[i].time << endl;
	  //	  break; //continue;
	}
      }
      St_tpcGas *tpcGas = (St_tpcGas *) set->Find("tpcGas");
      if (! tpcGas) {
	//	set->ls(9);
	cout << "==================================== tpcGas has not been found i = " << i << "\t" << dates[i].date << "\t" << dates[i].time << endl;
	continue;
      }
      dbMk->GetValidity(tpcGas,t);
      cout << "got " << tpcGas->GetName() << " for d/t " << dates[i].date << "/" << dates[i].time << endl;
      cout << "Found tpcGas " << tpcGas->GetName()  << endl;
      cout << "Validity:" << t[0].GetDate() << "/" << t[0].GetTime()
	   << " -----   " << t[1].GetDate() << "/" << t[1].GetTime() << endl;
      date = t[1].GetDate();
      time = t[1].GetTime();
      tpcGas_st *Gas = tpcGas->GetTable();
      if (k == 0) {
	//	tpcGas->Print(0,1);
	//      memcpy(&row.barometricPressure,&Gas->barometricPressure,sizeof(tpcGas_st));
	row.barometricPressure = Gas->barometricPressure;        // mbar : TPC-PTB
	row.inputTPCGasPressure = Gas->inputTPCGasPressure;       // mbar : TPC-PT8
	row.nitrogenPressure = Gas->nitrogenPressure;          // mbar : TPC-PI15
	row.gasPressureDiff = Gas->gasPressureDiff;           // mbar : TPC-PT7
	row.inputGasTemperature = Gas->inputGasTemperature;       // degrees C
	row.outputGasTemperature = Gas->outputGasTemperature;      // degrees C
	row.flowRateArgon1 = Gas->flowRateArgon1;            // liters/min : TPC-FM4
	row.flowRateArgon2 = Gas->flowRateArgon2;            // liters/min : TPC-FM4
	row.flowRateMethane = Gas->flowRateMethane;           // liters/min : TPC-FM1
	row.percentMethaneIn = Gas->percentMethaneIn;          // percent : TPC-CH4M3
	row.ppmOxygenIn = Gas->ppmOxygenIn;               // ppm : TPC-O2M1
	row.flowRateExhaust = Gas->flowRateExhaust;           // liters/min : TPC-PT11
	row.percentMethaneOut = Gas->percentMethaneOut;         // ppm : TPC-M4
	row.ppmWaterOut = Gas->ppmWaterOut;               // ppm : TPC-M2
	row.ppmOxygenOut = Gas->ppmOxygenOut;              // scf/hr : TPC-O2M1
	row.flowRateRecirculation = Gas->flowRateRecirculation;     // liters/min : TPC-F17
	cout << "got percentMethaneIn " << row.percentMethaneIn << endl;
	row.barometricPressureAv  = row.barometricPressure;
	row.inputGasTemperatureAv = row.inputGasTemperature;  
	row.outputGasTemperatureAv= row.outputGasTemperature; 
	row.percentMethaneInAv    = row.percentMethaneIn;     
	row.percentMethaneOutAv   = row.percentMethaneOut;    
      } else { // k > 0
	row.barometricPressureAv  = (k*row.barometricPressureAv   + Gas->barometricPressure)/(k+1.);
	row.inputGasTemperatureAv = (k*row.inputGasTemperatureAv  + Gas->inputGasTemperature)/(k+1.);
	row.outputGasTemperatureAv= (k*row.outputGasTemperatureAv + Gas->outputGasTemperature)/(k+1.);
	row.percentMethaneInAv    = (k*row.percentMethaneInAv     + Gas->percentMethaneIn)/(k+1.);
	row.percentMethaneOutAv   = (k*row.percentMethaneOutAv    + Gas->percentMethaneOut)/(k+1.);
      }
    }
    FitP->Fill(&row.day);
  }
}
